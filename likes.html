<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Likes | Commit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        github: {
                            bg: '#0d1117',
                            card: '#161b22',
                            border: '#30363d',
                            text: '#c9d1d9',
                            muted: '#8b949e',
                            btn: '#21262d',
                            green: '#238636',
                            accent: '#58a6ff'
                        }
                    },
                    fontFamily: {
                        mono: ['JetBrains Mono', 'monospace'],
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-github-bg text-github-text font-sans min-h-screen">
    <nav class="border-b border-github-border p-4 sticky top-0 bg-github-bg/95 backdrop-blur z-50">
        <div class="max-w-lg mx-auto flex items-center justify-between">
            <div class="flex items-center gap-4">
                <a href="index.html"
                    class="flex items-center gap-2 text-github-muted hover:text-github-accent transition">
                    <i data-lucide="arrow-left" class="w-6 h-6"></i>
                </a>
                <h1 class="font-bold text-lg">Activity</h1>
            </div>

            <!-- Matches Link -->
            <a href="matches.html" class="text-github-muted hover:text-github-accent transition relative"
                title="Matches">
                <i data-lucide="message-circle" class="w-6 h-6"></i>
            </a>
        </div>

        <!-- Tabs -->
        <div class="flex max-w-lg mx-auto mt-4 border-b border-github-border">
            <button id="tab-liked-me"
                class="flex-1 pb-3 text-sm font-bold text-github-accent border-b-2 border-github-accent transition">
                Liked You
            </button>
            <button id="tab-my-likes"
                class="flex-1 pb-3 text-sm font-bold text-github-muted hover:text-github-text transition">
                Your Likes
            </button>
        </div>
    </nav>

    <main class="max-w-lg mx-auto p-4">
        <div id="grid-container" class="grid grid-cols-2 gap-4">
            <!-- Injected -->
        </div>
    </main>

    <script type="module">
        import { datastore } from './datastore.js';

        lucide.createIcons();

        const container = document.getElementById('grid-container');
        const tabLikedMe = document.getElementById('tab-liked-me');
        const tabMyLikes = document.getElementById('tab-my-likes');

        async function renderProfiles(profiles, isBlur = false) {
            container.innerHTML = '';

            if (!profiles || profiles.length === 0) {
                container.innerHTML = `<p class="col-span-2 text-center text-github-muted py-10">No pending likes.</p>`;
                return;
            }

            profiles.forEach(p => {
                const card = document.createElement('div');
                card.className = "relative group overflow-hidden rounded-xl border border-github-border bg-github-card aspect-[3/4]";

                // Action Buttons for "Liked Me" tab only
                let actionsHtml = '';
                if (!isBlur) {
                    actionsHtml = `
                    <div class="absolute top-2 right-2 flex gap-2 opacity-0 group-hover:opacity-100 transition z-10">
                        <button onclick="window.handleAction(${p.id}, 'pass', this)" class="bg-black/50 p-2 rounded-full hover:bg-red-500/80 text-white backdrop-blur transition border border-white/10" title="Pass">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                        <button onclick="window.handleAction(${p.id}, 'like', this)" class="bg-black/50 p-2 rounded-full hover:bg-green-500/80 text-white backdrop-blur transition border border-white/10" title="Like Back">
                            <i data-lucide="heart" class="w-4 h-4"></i>
                        </button>
                    </div>
                    `;
                }

                card.innerHTML = `
                    ${actionsHtml}
                    <div onclick="window.location.href='view-profile.html?id=${p.id}&return=likes'" class="cursor-pointer w-full h-full relative">
                        <img src="${p.image}" class="w-full h-full object-cover transition transform group-hover:scale-110">
                        <div class="absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/90 to-transparent p-3 pt-12">
                            <h3 class="font-bold text-white text-sm">${p.name}, <span class="text-xs text-github-muted font-normal">Dev</span></h3>
                            <div class="flex gap-1 mt-1 flex-wrap">
                                ${(p.stack || []).slice(0, 2).map(s => `<span class="text-[10px] bg-white/10 px-1 rounded text-white/80">${s}</span>`).join('')}
                            </div>
                        </div>
                        ${isBlur ? '<div class="absolute inset-0 backdrop-blur-[2px] flex items-center justify-center bg-black/20"><i data-lucide="lock" class="text-white/50 w-8 h-8"></i></div>' : ''}
                    </div>
                `;
                container.appendChild(card);
            });
            lucide.createIcons();
        }

        window.handleAction = async (id, type, btn) => {
            event.stopPropagation(); // Don't click card
            const res = await datastore.saveLike(id, type);
            if (res) {
                // If match, alert
                if (type === 'like' && res.match) {
                    // Simple confirm to go to matches
                    if (confirm(`It's a Match! ðŸ’–\nStart chatting with them?`)) {
                        window.location.href = 'matches.html';
                        return;
                    }
                }
                // Remove card visual
                const card = btn.closest('.relative'); // div.relative
                card.style.transition = "transform 0.3s, opacity 0.3s";
                card.style.transform = "scale(0.8)";
                card.style.opacity = "0";
                setTimeout(() => card.remove(), 300);
            }
        };

        async function loadLikedMe() {
            const profiles = await datastore.getWhoLikedMe();
            renderProfiles(profiles, false);
        }

        async function loadMyLikes() {
            const profiles = await datastore.getMyLikes();
            renderProfiles(profiles, true); // Blur or just show them (User passed 'true' in original code implying isBlur, maybe for 'Locked' premium feature? Assuming logic holds)
            // Wait, original code passed NO arg for loadMyLikes, so isBlur=false.
            // But usually 'My Likes' might require premium to see unless matched? 
            // The original code in my view (Step 1020) had: loadMyLikes -> renderProfiles(profiles).
            // Default isBlur = false.
            // Let's keep it visible for now.
        }

        // Init: Liked Me
        loadLikedMe();

        tabLikedMe.addEventListener('click', () => {
            tabLikedMe.className = "flex-1 pb-3 text-sm font-bold text-github-accent border-b-2 border-github-accent transition";
            tabMyLikes.className = "flex-1 pb-3 text-sm font-bold text-github-muted hover:text-github-text transition";
            loadLikedMe();
        });

        tabMyLikes.addEventListener('click', () => {
            tabMyLikes.className = "flex-1 pb-3 text-sm font-bold text-github-accent border-b-2 border-github-accent transition";
            tabLikedMe.className = "flex-1 pb-3 text-sm font-bold text-github-muted hover:text-github-text transition";
            loadMyLikes();
        });

    </script>
</body>

</html>